---
tags:
  - LeetCode
---

# [1277. Count Square Submatrices with All Ones](https://leetcode.com/problems/count-square-submatrices-with-all-ones/description/)  

+ 日期 : 2025/08/20  

## 問題描述  

給定一個二維數字陣列 `matrix`，問有多少個正方形子矩陣的所有元素都是 `1`。  

## 直覺想法  

這是一個經典 `DP` 題目，但現在的我對 `DP` 基本概念幾乎為 `0`，  
我的想法是，如果當下這個位置是 `1`，那就一起檢查 `上`、`左`、`左上` 三個方向，  
如果這三個都大於 `0`，表示我至少可以組成一個 `2x2` 的正方形，  
至於能組成多大必須看這三個之中的最小值，該值表示那個位置能組成的最大正方形邊長。  

## 題解  

```cpp=
class Solution {
public:
    int countSquares(vector<vector<int>>& matrix) {
        int m = matrix.size();
        int n = matrix[0].size();
        vector<vector<int>> dp(m, vector<int>(n, 0));

        int res = 0;
        for(int i = 0; i < m; ++i) {
            for(int j = 0; j < n; ++j) {
                dp[i][j] = matrix[i][j];
                if(check(matrix, i, j))
                    dp[i][j] += min(dp[i-1][j-1], min(dp[i-1][j], dp[i][j-1]));
                res += dp[i][j];
            }
        }
        return res;
    }

    bool check(vector<vector<int>> &matrix, int i, int j) {
        int m = matrix.size();
        int n = matrix[0].size();
        if(
            (i - 1 < 0) ||
            (j - 1 < 0)
        )   return false;

        return (matrix[i-1][j-1] & matrix[i-1][j] & matrix[i][j-1] & matrix[i][j]);
    }
    /*
    000
    010
    010
    111
    110
    */
};
```

Time Complexity : $O(nm)$  
Space Complexity : $O(nm)$  

## 心得  

這題是很好的 `DP` 練習，能用最暴力的方式解出來，然後一步一步優化，  
但現在的我工作在燒，我只想休息...  
